Stock Harvest AI - 要件定義書

要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

## 1. プロジェクト概要

### 1.1 成果目標
人間には不可能な東証全銘柄（約3,800社）の24時間監視をAIが実行し、投資チャンスを逃さないシステム

### 1.2 成功指標

#### 定量的指標
- 全銘柄スキャン速度：3,800銘柄を5分以内で分析完了
- 異常検知精度：出来高急増・価格急変を99%以上検出
- 情報圧縮率：3,800銘柄から注目すべき10-20銘柄に絞り込み
- 見逃し率：重要なシグナルの見逃しを1%未満に抑制

#### 定性的指標
- 「もう相場を見続ける必要がない」安心感
- 「AIが24時間監視してくれている」という信頼感
- 「本当に重要な銘柄だけに集中できる」効率性
- 「人間では気づけないパターンを発見できる」発見性

## 2. システム全体像

### 2.1 主要機能一覧 (草田さん優先度A機能のみ)
- **ロジックスキャナー機能**: ロジックA強化版(ストップ高張り付き精密検出)とロジックB強化版(黒字転換銘柄精密検出)
- **チャート表示機能**: 各ロジックで検出した銘柄のチャート表示
- **手動決済シグナル**: 損切り・利確タイミングの通知と決済実行
- **売買支援機能**: エントリーポイント最適化と注文支援（IFDOCO注文ガイド）
- **アラート機能**: 価格到達アラートとLINE通知
- **問合せ機能**: システムサポートと技術的質問

### 2.2 ユーザーロールと権限
- 個人ユーザー: 全機能へのフルアクセス（認証なし）

### 2.3 認証・認可要件
- 認証方式: 当面は認証なし（ローカル環境での個人利用）
- セキュリティレベル: APIキー等は環境変数で管理
- 管理機能: 不要（将来的に拡張可能な設計）

## 3. ページ詳細仕様 (優先度A機能のみ、3ページ構成)

### 3.1 P-001: ロジックスキャナーダッシュボード
実装済み: ダッシュボード基本機能、スキャン実行、ロジック結果表示、システム状態表示
新機能要件: 
- ロジックA強化版対応（ストップ高張り付き精密検出）
- ロジックB強化版対応（黒字転換銘柄精密検出）
- 売買シグナル自動計算表示
- エントリーポイント最適化アドバイス

### 3.2 P-002: アラート設定  
実装済み: アラート作成・一覧・切替・削除、LINE通知設定画面
新機能要件:
- IFDOCO注文ガイド表示
- 利確・損切り自動アラート設定

### 3.3 P-003: 問合せサポート
実装済み: FAQ表示、問合せフォーム、システム情報表示

## 4. データ設計
実装済み: 全テーブル定義完了（詳細はbackend/src/database/tables.py参照）
- system_info, faq, alerts, line_notification_config
- contact_inquiries, scan_executions, scan_results
- stock_master, manual_signals

新機能要件:
- 上場日情報テーブル
- 決算スケジュールテーブル（四半期別）
- 制限値幅情報テーブル
- 売買履歴管理テーブル
- IRバンク・カブタン連携データテーブル

## 5. 制約事項

### 外部API制限
- **Yahoo Finance**: アクセス頻度制限あり（詳細は非公開）
- **LINE Notify**: 1000件/月の送信制限

### 技術的制約
- **リアルタイムデータ**: 20分遅延（無料API使用時）
- **スキャン頻度**: 5分に1回が現実的な上限

## 6. APIエンドポイント
実装済み: 全主要エンドポイント実装完了
- スキャン機能: `/api/scan/execute`, `/api/scan/status`, `/api/scan/results`
- アラート機能: `/api/alerts/*`, `/api/notifications/line/*`
- サポート機能: `/api/contact/*`, `/api/system/*`
- 決済シグナル: `/api/signals/*`
- チャート機能: `/api/charts/*`

新機能要件:
- ロジック強化版: `/api/scan/logic-a-enhanced`, `/api/scan/logic-b-enhanced`
- 売買支援: `/api/trading/entry-optimization`, `/api/trading/ifdoco-guide`
- 履歴管理: `/api/history/trades`, `/api/history/signals`
- 外部連携: `/api/integration/ir-bank`, `/api/integration/kabutan`

## 7. 技術スタック (実装済み)
- **フロントエンド**: React 19.1, TypeScript 5.9, MUI v7, Recharts 3.3, Zustand 5.0
- **バックエンド**: Python 3.11+, FastAPI 0.104.1, yfinance, pandas, ta-lib  
- **データベース**: PostgreSQL (完全実装済み)
- **テスト**: Playwright 1.56.1 (98項目 100%実装済み)
- **デプロイ**: Vercel対応済み

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Yahoo Finance | 株価データ取得 | pip install yfinance | 無料 |
| Neon | データベース | https://neon.tech | 無料枠あり |
| LINE Notify | アラート通知 | https://notify-bot.line.me | 無料 |
| 日本取引所グループ | 上場日データ | https://www.jpx.co.jp | 無料 |

### オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| OpenAI API | AI分析レポート生成 | https://openai.com | 月$20程度 |
| IRバンク | 決算データ連携 | https://irbank.net | API利用要確認 |
| カブタン | 適時開示情報 | https://kabutan.jp | API利用要確認 |

## 9. 新機能詳細仕様

### 9.1 ロジックA強化版（ストップ高張り付き精密検出）

#### セミナーノウハウ対応仕様
- **上場条件**: 上場2年半以内（最大5年以内）の企業を対象
- **決算タイミング**: 四半期決算翌日のストップ高張り付き検出
- **初回条件**: 上場後初回条件達成の履歴管理
- **除外ルール**:
  - 2連続ストップ高銘柄の除外
  - 下髭が長い銘柄の除外
  - 決算発表以外でのストップ高除外

#### 売買ルール
- **エントリー**: +5%上昇時の買いシグナル
- **利確**: +24%到達での利確シグナル
- **損切り**: -10%到達での損切りシグナル
- **最大保有期間**: 設定可能（デフォルト1ヶ月）

### 9.2 ロジックB強化版（黒字転換銘柄精密検出）

#### 詳細仕様書対応
- **転換条件**: 直近1年間で初めて経常利益黒字転換
- **エントリーシステム**: 5日移動平均線上抜けタイミング
- **利確・損切り**: +25%利確/-10%損切りルール
- **最大保有期間**: 1.5ヶ月以内
- **データ連携**: IRバンク・カブタンとの決算データ連携

### 9.3 必要なデータソース追加

#### 上場日データ（日本取引所グループ）
- 全上場企業の上場日情報
- IPO予定企業情報
- 上場廃止予定企業情報

#### 制限値幅情報
- 各銘柄のストップ高・ストップ安価格
- 値幅制限の段階的設定対応
- リアルタイム制限値幅更新

#### 決算スケジュール（四半期別）
- 全企業の決算発表予定日
- 決算発表実績日の記録
- 業績予想修正情報

#### IRバンク・カブタン連携
- 適時開示情報の自動取得
- 決算短信データの構造化
- 業績予想データの取得・比較

### 9.4 新機能要件

#### 売買シグナル自動計算
- ロジック条件に基づく自動シグナル生成
- エントリー・利確・損切りタイミングの計算
- シグナル信頼度の数値化

#### エントリーポイント最適化
- 過去データに基づく最適エントリー価格の算出
- 市場状況を考慮した調整機能
- リスクリワード比率の自動計算

#### 注文支援機能（IFDOCO注文ガイド）
- エントリー価格の推奨設定
- 利確・損切り価格の自動設定
- 注文方法のステップバイステップガイド

#### 履歴管理システム
- 全売買シグナルの履歴保存
- パフォーマンス分析機能
- 勝率・平均利益率の算出
- 改善点の自動分析

## 10. 今後の拡張予定
- 米国株対応
- 投資信託・ETF対応
- 複数ユーザー対応（認証機能追加）
- モバイルアプリ化

---