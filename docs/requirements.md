Stock Harvest AI - 要件定義書

要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

## 1. プロジェクト概要

### 1.1 成果目標
人間には不可能な東証全銘柄（約3,800社）の24時間監視をAIが実行し、投資チャンスを逃さないシステム

### 1.2 成功指標

#### 定量的指標
- 全銘柄スキャン速度：3,800銘柄を5分以内で分析完了
- 異常検知精度：出来高急増・価格急変を99%以上検出
- 情報圧縮率：3,800銘柄から注目すべき10-20銘柄に絞り込み
- 見逃し率：重要なシグナルの見逃しを1%未満に抑制

#### 定性的指標
- 「もう相場を見続ける必要がない」安心感
- 「AIが24時間監視してくれている」という信頼感
- 「本当に重要な銘柄だけに集中できる」効率性
- 「人間では気づけないパターンを発見できる」発見性

## 2. システム全体像

### 2.1 主要機能一覧 (草田さん優先度A機能のみ)
- **ロジックスキャナー機能**: ロジックA(ストップ高張り付き)とロジックB(赤字→黒字転換)の検出
- **チャート表示機能**: 各ロジックで検出した銘柄のチャート表示
- **手動決済シグナル**: 損切り・利確タイミングの通知と決済実行
- **アラート機能**: 価格到達アラートとLINE通知
- **問合せ機能**: システムサポートと技術的質問

### 2.2 ユーザーロールと権限
- 個人ユーザー: 全機能へのフルアクセス（認証なし）

### 2.3 認証・認可要件
- 認証方式: 当面は認証なし（ローカル環境での個人利用）
- セキュリティレベル: APIキー等は環境変数で管理
- 管理機能: 不要（将来的に拡張可能な設計）

## 3. ページ詳細仕様 (優先度A機能のみ、3ページ構成)

### 3.1 P-001: ロジックスキャナーダッシュボード

#### 目的
全銘柄スキャン結果を一目で把握し、投資判断に必要な情報を即座に確認

#### 主要機能
- 全銘柄AIスキャンの実行（ワンクリック）
- 注目銘柄TOP10-20の表示
- 各銘柄の買いシグナル強度表示
- 推奨エントリー価格・損切り・利確ラインの表示
- 銘柄詳細ページへの遷移

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 全銘柄スキャン結果取得 | なし | 注目銘柄リスト |
| 作成 | スキャン実行 | スキャン条件（オプション） | 新規スキャン結果 |
| 更新 | フィルター条件変更 | フィルター設定 | 絞り込み結果 |

#### 処理フロー
1. ユーザーが「今すぐスキャン」ボタンをクリック
2. システムが全3,800銘柄をAI分析
3. スコアリング結果に基づきTOP10-20を表示
4. 各銘柄の売買推奨価格を自動計算して表示

#### データ構造(概念)
```yaml
スキャン結果:
  識別子: スキャンID（日時ベース）
  基本情報:
    - 実行日時(必須)
    - 対象銘柄数(必須)
    - 検出銘柄数(必須)
  銘柄リスト:
    - 証券コード
    - 銘柄名
    - シグナル強度
    - 推奨価格情報
```

### 3.2 P-002: アラート設定

#### 目的
価格到達アラートとロジック発動時の即時通知設定

#### 主要機能
- 価格到達アラート設定(上回り/下回り)
- ロジックA/B発動時のアラート設定
- LINE通知連携設定
- アラートの有効/無効切り替え
- 設定済みアラート一覧管理

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | アラート一覧取得 | なし | 設定済みアラートリスト |
| 作成 | アラート作成 | 銘柄・条件・価格 | 作成結果 |
| 更新 | アラート有効化/無効化 | アラートID・状態 | 更新結果 |
| 削除 | アラート削除 | アラートID | 削除結果 |

### 3.3 P-003: 問合せサポート

#### 目的
システムに関する技術的質問、機能要望、サポート窓口

#### 主要機能
- よくある質問(FAQ)表示
- お問い合わせフォーム(技術問題/機能要望/不具合報告/その他)
- システム情報表示(バージョン、稼働状態など)
- メール送信機能

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | FAQ表示 | なし | よくある質問リスト |
| 作成 | 問合せ送信 | 種別・件名・内容・連絡先 | 送信結果 |
| 取得 | システム情報取得 | なし | バージョン・稼働状況 |

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
銘柄マスタ:
  概要: 東証全銘柄の基本情報
  主要属性:
    - 証券コード、銘柄名、業種
    - 上場市場、時価総額
  関連:
    - 価格データ(1対多)
    - スキャン結果(多対多)

価格データ:
  概要: 日次の価格・出来高情報
  主要属性:
    - 日付、始値、高値、安値、終値
    - 出来高、各種テクニカル指標
  関連:
    - 銘柄マスタ(多対1)

スキャン結果:
  概要: AIスキャンの実行結果
  主要属性:
    - 実行日時、スキャン条件
    - 検出銘柄リスト、スコア
  関連:
    - 銘柄マスタ(多対多)

ポートフォリオ:
  概要: ユーザーの保有銘柄情報
  主要属性:
    - 銘柄、購入価格、数量
    - 目標価格、損切り価格
  関連:
    - 銘柄マスタ(多対1)
```

### 4.2 エンティティ関係図
```
銘柄マスタ ─┬─ 価格データ (1対多)
          ├─ スキャン結果 (多対多)
          └─ ポートフォリオ (1対多)
```

## 5. 制約事項

### 外部API制限
- **Yahoo Finance**: アクセス頻度制限あり（詳細は非公開）
- **LINE Notify**: 1000件/月の送信制限

### 技術的制約
- **リアルタイムデータ**: 20分遅延（無料API使用時）
- **スキャン頻度**: 5分に1回が現実的な上限

## 6. 複合API処理(バックエンド内部処理)

### 複合処理-001: 全銘柄AIスキャン
**トリガー**: 「今すぐスキャン」ボタンクリック
**フロントエンドAPI**: POST /api/scan/execute
**バックエンド内部処理**:
1. 全3,800銘柄の最新価格データ取得（Yahoo Finance）
2. テクニカル指標の一括計算（200以上の指標）
3. AI分析によるスコアリング
4. TOP銘柄の選出と詳細分析
5. 結果のDB保存
**結果**: 注目銘柄リストと推奨価格
**外部サービス依存**: Yahoo Finance API

### 複合処理-002: 売買価格自動算出
**トリガー**: 銘柄選択または詳細表示
**フロントエンドAPI**: GET /api/stock/{code}/analysis
**バックエンド内部処理**:
1. 過去60日分の価格データ取得
2. ATR計算による価格レンジ算出
3. サポート・レジスタンスライン検出
4. リスクリワード比に基づく目標価格設定
**結果**: エントリー・利確・損切り価格
**外部サービス依存**: Yahoo Finance API

## 7. 技術スタック

- **フロントエンド**: React 18, TypeScript 5, MUI v6, Recharts
- **バックエンド**: Python, FastAPI, pandas, ta-lib
- **データベース**: PostgreSQL (Neon)
- **インフラ**: Vercel (Frontend), Google Cloud Run (Backend)

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Yahoo Finance | 株価データ取得 | pip install yfinance | 無料 |
| Neon | データベース | https://neon.tech | 無料枠あり |
| LINE Notify | アラート通知 | https://notify-bot.line.me | 無料 |

### オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| OpenAI API | AI分析レポート生成 | https://openai.com | 月$20程度 |

## 9. 今後の拡張予定
- 米国株対応
- 投資信託・ETF対応
- 複数ユーザー対応（認証機能追加）
- モバイルアプリ化

---